// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  // CORRECTED: Use env() to keep your password safe
  url      = env("DATABASE_URL")
}

model companies {
  id                String              @id @db.VarChar(50)
  name              String              @db.VarChar(255)
  shortName         String              @db.VarChar(100)
  dashboard_stats   Json?
  balance_sheet     Json?
  income_statement  Json?
  cash_flow         Json?
  trial_balance     Json?
  users             users[]
  debtors           debtors[]
  creditors         creditors[]
  inventory_items   inventory_items[]
  sales             sales[]
  purchases         purchases[]
  fixed_assets      fixed_assets[]
  process_loss      process_loss[]
  chart_of_accounts chart_of_accounts[]
}

model users {
  id         Int        @id @default(autoincrement())
  email      String     @unique @db.VarChar(255)
  password   String     @db.VarChar(255)
  role       Role       @default(USER)
  name       String     @db.VarChar(255)
  company_id String?    @db.VarChar(50)
  company    companies? @relation(fields: [company_id], references: [id], onDelete: SetNull)
}

model debtors {
  id            Int       @id @default(autoincrement())
  company_id    String    @db.VarChar(50)
  name          String    @db.VarChar(255)
  contactPerson String?   @db.VarChar(255)
  email         String?   @db.VarChar(255)
  phone         String?   @db.VarChar(50)
  amount        Decimal   @db.Decimal(12, 2)
  due           DateTime  @db.Date
  aging         Int
  company       companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
}

model creditors {
  id            Int       @id @default(autoincrement())
  company_id    String    @db.VarChar(50)
  name          String    @db.VarChar(255)
  contactPerson String?   @db.VarChar(255)
  amount        Decimal   @db.Decimal(12, 2)
  due           DateTime  @db.Date
  aging         Int
  company       companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
}

model inventory_items {
  id         String    @id @db.VarChar(50)
  company_id String    @db.VarChar(50)
  name       String    @db.VarChar(255)
  sku        String    @db.VarChar(100)
  category   String    @db.VarChar(100)
  stock      Int
  unit       String    @db.VarChar(50)
  costPrice  Decimal   @db.Decimal(12, 2)
  salePrice  Decimal   @db.Decimal(12, 2)
  status     String    @db.VarChar(50)
  company    companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
  sale_items sale_items[]
}

model sales {
  id          Int          @id @default(autoincrement())
  company_id  String       @db.VarChar(50)
  customer    String?      @db.VarChar(255)
  date        DateTime     @default(now())
  totalAmount Decimal      @db.Decimal(12, 2)
  status      String       @db.VarChar(50)
  company     companies    @relation(fields: [company_id], references: [id], onDelete: Cascade)
  items       sale_items[]
}

model sale_items {
  id         Int             @id @default(autoincrement())
  sale_id    Int
  product_id String          @db.VarChar(50)
  quantity   Int
  price      Decimal         @db.Decimal(12, 2)
  sale       sales           @relation(fields: [sale_id], references: [id], onDelete: Cascade)
  product    inventory_items @relation(fields: [product_id], references: [id])
}

model purchases {
  id         String    @id @db.VarChar(50)
  company_id String    @db.VarChar(50)
  supplier   String    @db.VarChar(255)
  date       DateTime  @db.Date
  amount     Decimal   @db.Decimal(12, 2)
  status     String    @db.VarChar(50)
  company    companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
}

model fixed_assets {
  id              String    @id @db.VarChar(50)
  company_id      String    @db.VarChar(50)
  name            String    @db.VarChar(255)
  acquisitionDate DateTime  @db.Date
  cost            Decimal   @db.Decimal(15, 2)
  depreciation    Decimal   @db.Decimal(15, 2)
  bookValue       Decimal   @db.Decimal(15, 2)
  company         companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
}

model process_loss {
  id         String    @id @db.VarChar(50)
  company_id String    @db.VarChar(50)
  date       DateTime  @db.Date
  product    String    @db.VarChar(255)
  type       String    @db.VarChar(100)
  quantity   Decimal   @db.Decimal(12, 2)
  unit       String    @db.VarChar(50)
  notes      String?   @db.Text
  company    companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
}

model chart_of_accounts {
  id         Int       @id @default(autoincrement())
  company_id String    @db.VarChar(50)
  code       Int
  name       String    @db.VarChar(255)
  type       String    @db.VarChar(50)
  balance    Decimal   @db.Decimal(15, 2)
  company    companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
}

enum Role {
  USER
  MANAGER
  ADMIN
}